import Logger from "./Logger";
import { expect } from 'chai'
import mockPostJson from "../mocks/mockPostJson";

const getAddress = () => '0x69'

describe('Logger', () => {
  it('should log metrics to api', async () => {
    const metrics = [
      {
        name: 'metric2',
        ts: new Date(),
        data: {address: getAddress},
      },
      {
        name: 'metric1',
        ts: new Date(),
        data: {},
      },
    ]

    const postJson = (url: string, { metrics }: any) => {
      const expected = metrics.map((metric: any) => ({...metric, address: '069'}))
      expect(
        metrics
      ).to.deep.equal(expected)
    }

    const logger = new Logger({source: '', method: '', getAddress: async () => ''}, postJson as any)

    await logger.logToApi(metrics)
  })
})